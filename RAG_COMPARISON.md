# –°—Ä–∞–≤–Ω–µ–Ω–∏–µ RAG —Å–∏—Å—Ç–µ–º

## üîß –ë–∞–∑–æ–≤–∞—è RAG —Å–∏—Å—Ç–µ–º–∞ (`rag_system.py`)

### –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:
- **–ü–æ–∏—Å–∫ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ—Å—Ç–æ–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ
- **–ü—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —Å–∏–Ω–æ–Ω–∏–º—ã**: –ñ–µ—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–Ω—ã–π —Å–ª–æ–≤–∞—Ä—å —Å–∏–Ω–æ–Ω–∏–º–æ–≤
- **SequenceMatcher**: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏
- **JSON –ø–æ–∏—Å–∫**: –ü—Ä—è–º–æ–π –ø–æ–∏—Å–∫ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ JSON —Ñ–∞–π–ª–∞

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
‚úÖ –ë—ã—Å—Ç—Ä–∞—è —Ä–∞–±–æ—Ç–∞ (–Ω–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–µ–π)
‚úÖ –ü—Ä–æ—Å—Ç–∞—è –æ—Ç–ª–∞–¥–∫–∞ –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏
‚úÖ –ú–∞–ª–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:
‚ùå –ù–µ –ø–æ–Ω–∏–º–∞–µ—Ç —Å–µ–º–∞–Ω—Ç–∏–∫—É (—Å–º—ã—Å–ª) –∑–∞–ø—Ä–æ—Å–æ–≤
‚ùå –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å —Ç–æ—á–Ω—ã–º–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è–º–∏ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
‚ùå –ù–µ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –∫ –Ω–æ–≤—ã–º —Ç–∏–ø–∞–º –∑–∞–ø—Ä–æ—Å–æ–≤
‚ùå –ñ–µ—Å—Ç–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å–∏–Ω–æ–Ω–∏–º–æ–≤
‚ùå –ú–æ–∂–µ—Ç –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é

## üöÄ –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è RAG —Å–∏—Å—Ç–µ–º–∞ (`modern_rag_system.py`)

### –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:
- **–í–µ–∫—Ç–æ—Ä–Ω—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏**: SentenceTransformers –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Ç–µ–∫—Å—Ç –≤ –≤–µ–∫—Ç–æ—Ä—ã
- **–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫**: ChromaDB –∏—â–µ—Ç –ø–æ —Å–º—ã—Å–ª–æ–≤–æ–º—É —Å—Ö–æ–¥—Å—Ç–≤—É
- **Cosine similarity**: –í—ã—á–∏—Å–ª—è–µ—Ç —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫—É—é –±–ª–∏–∑–æ—Å—Ç—å –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–æ–º –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ**: –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
‚úÖ –ü–æ–Ω–∏–º–∞–µ—Ç —Å–º—ã—Å–ª –∑–∞–ø—Ä–æ—Å–æ–≤ (—Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫)
‚úÖ –ù–∞—Ö–æ–¥–∏—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–∞–∂–µ –ø—Ä–∏ —Ä–∞–∑–Ω–æ–π —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–µ
‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å —Å–∏–Ω–æ–Ω–∏–º–∞–º–∏ –∏ –ø–æ—Ö–æ–∂–∏–º–∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏—è–º–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ—Å—Ç—å
‚úÖ –ê–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –∫ –Ω–æ–≤—ã–º —Ç–∏–ø–∞–º –∑–∞–ø—Ä–æ—Å–æ–≤
‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ–±—É—á–µ–Ω–∏—è –∏ —É–ª—É—á—à–µ–Ω–∏—è
‚úÖ –ö–æ–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ (similarity score)

### –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:
‚ùå –¢—Ä–µ–±—É–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ (~500MB)
‚ùå –ü–æ—Ç—Ä–µ–±–ª—è–µ—Ç –±–æ–ª—å—à–µ –ø–∞–º—è—Ç–∏ –∏ CPU
‚ùå –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –º–µ–¥–ª–µ–Ω–Ω–µ–µ (—Å–æ–∑–¥–∞–Ω–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤)
‚ùå –¢—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

## üìä –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –ë–∞–∑–æ–≤–∞—è RAG | –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è RAG |
|----------|-------------|------------------|
| **–ü–æ–Ω–∏–º–∞–Ω–∏–µ —Å–º—ã—Å–ª–∞** | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ |
| **–°–∫–æ—Ä–æ—Å—Ç—å –∑–∞–ø—É—Å–∫–∞** | ‚úÖ –ë—ã—Å—Ç—Ä–æ | ‚ùå –ú–µ–¥–ª–µ–Ω–Ω–æ |
| **–ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏** | ‚úÖ –ú–∞–ª–æ (~50MB) | ‚ùå –ú–Ω–æ–≥–æ (~500MB) |
| **–¢–æ—á–Ω–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞** | ‚ùå –ù–∏–∑–∫–∞—è | ‚úÖ –í—ã—Å–æ–∫–∞—è |
| **–ì–∏–±–∫–æ—Å—Ç—å** | ‚ùå –ñ–µ—Å—Ç–∫–∞—è | ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è |
| **–ü—Ä–æ—Å—Ç–æ—Ç–∞ –æ—Ç–ª–∞–¥–∫–∏** | ‚úÖ –ü—Ä–æ—Å—Ç–∞—è | ‚ùå –°–ª–æ–∂–Ω–∞—è |
| **–†–∞–±–æ—Ç–∞ —Å —Å–∏–Ω–æ–Ω–∏–º–∞–º–∏** | ‚ùå –ü—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ |
| **–ú–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ—Å—Ç—å** | ‚ùå –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è | ‚úÖ –ü–æ–ª–Ω–∞—è |

## üéØ –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —á—Ç–æ?

### –ë–∞–∑–æ–≤–∞—è RAG –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:
- –ü—Ä–æ—Ç–æ—Ç–∏–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ (–ø–∞–º—è—Ç—å, CPU)
- –ü—Ä–æ—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –∏–∑–≤–µ—Å—Ç–Ω—ã–º–∏ –∫–ª—é—á–µ–≤—ã–º–∏ —Å–ª–æ–≤–∞–º–∏
- –ë—ã—Å—Ç—Ä–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è RAG –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:
- –ü—Ä–æ–¥–∞–∫—à–Ω-—Å–∏—Å—Ç–µ–º —Å –≤—ã—Å–æ–∫–∏–º–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –∫ –∫–∞—á–µ—Å—Ç–≤—É
- –°–ª–æ–∂–Ω—ã—Ö –∏ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–æ–Ω–∏–º–∞–Ω–∏—è —Å–µ–º–∞–Ω—Ç–∏–∫–∏ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –°–∏—Å—Ç–µ–º, –≥–¥–µ –≤–∞–∂–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞

## üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ

–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π RAG —Å–∏—Å—Ç–µ–º—ã:

```python
# –ï—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ - –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—É—é RAG
if MODERN_RAG_AVAILABLE:
    context = await get_context_for_query_async(message.text)
else:
    # Fallback –Ω–∞ –±–∞–∑–æ–≤—É—é RAG
    context = rag_system.get_context_for_query(message.text)
```

## üõ†Ô∏è –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

- `/test_rag` - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–π RAG —Å–∏—Å—Ç–µ–º—ã
- `/test_modern_rag` - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π RAG —Å–∏—Å—Ç–µ–º—ã  
- `/rag_stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ–∫—É—â–µ–π RAG —Å–∏—Å—Ç–µ–º—ã
- `/reload_kb` - –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π

## üìà –ü—Ä–∏–º–µ—Ä—ã —É–ª—É—á—à–µ–Ω–∏–π

### –ë–∞–∑–æ–≤–∞—è RAG:
```
–ó–∞–ø—Ä–æ—Å: "—Ä–æ–±–æ—Ç–æ—Ç–µ—Ö–Ω–∏–∫–∞ –¥–ª—è –¥–µ—Ç–µ–π"
–ü–æ–∏—Å–∫: ["—Ä–æ–±–æ—Ç–æ—Ç–µ—Ö–Ω–∏–∫–∞", "–¥–µ—Ç–µ–π"] ‚Üí —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –≤ JSON
```

### –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è RAG:
```
–ó–∞–ø—Ä–æ—Å: "–∫—É—Ä—Å—ã –ø–æ —Ä–æ–±–æ—Ç–∞–º –¥–ª—è —à–∫–æ–ª—å–Ω–∏–∫–æ–≤"  
–ü–æ–∏—Å–∫: –≤–µ–∫—Ç–æ—Ä–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ ‚Üí –Ω–∞—Ö–æ–¥–∏—Ç "—Ä–æ–±–æ—Ç–æ—Ç–µ—Ö–Ω–∏–∫–∞ –¥–ª—è –¥–µ—Ç–µ–π"
Similarity: 0.87 (87% —Å—Ö–æ–¥—Å—Ç–≤–∞)
```

–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è RAG –ø–æ–Ω–∏–º–∞–µ—Ç, —á—Ç–æ "–∫—É—Ä—Å—ã –ø–æ —Ä–æ–±–æ—Ç–∞–º" ‚âà "—Ä–æ–±–æ—Ç–æ—Ç–µ—Ö–Ω–∏–∫–∞", –∞ "—à–∫–æ–ª—å–Ω–∏–∫–∏" ‚âà "–¥–µ—Ç–∏". 