#!/bin/bash

# üöÄ –°–∫—Ä–∏–ø—Ç –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —É–ª—É—á—à–µ–Ω–∏–π TechnoBot

echo "üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–ª—É—á—à–µ–Ω–∏–π TechnoBot"
echo "============================================="

# –ü—Ä–æ–≤–µ—Ä—è–µ–º Python
if ! command -v python3 &> /dev/null; then
    echo "‚ùå Python3 –Ω–µ –Ω–∞–π–¥–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Python 3.8+"
    exit 1
fi

echo "‚úÖ Python –Ω–∞–π–¥–µ–Ω: $(python3 --version)"

# –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –µ—Å–ª–∏ –µ—Å—Ç—å
if [ -f "venv/bin/activate" ]; then
    echo "üì¶ –ê–∫—Ç–∏–≤–∞—Ü–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è..."
    source venv/bin/activate
else
    echo "‚ö†Ô∏è –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –°–æ–∑–¥–∞–π—Ç–µ –µ–≥–æ:"
    echo "   python3 -m venv venv"
    echo "   source venv/bin/activate"
fi

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–æ–≤—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
pip3 install dateparser>=1.1.8 aioredis>=2.0.1 tenacity>=8.2.0

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å—Ç–∞–Ω–æ–≤–∫—É Redis (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
echo "üî¥ –ü—Ä–æ–≤–µ—Ä–∫–∞ Redis..."
if command -v redis-server &> /dev/null; then
    echo "‚úÖ Redis –Ω–∞–π–¥–µ–Ω: $(redis-server --version | head -1)"
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø—É—â–µ–Ω –ª–∏ Redis
    if redis-cli ping &> /dev/null; then
        echo "‚úÖ Redis –∑–∞–ø—É—â–µ–Ω"
    else
        echo "‚ö†Ô∏è Redis –Ω–µ –∑–∞–ø—É—â–µ–Ω. –ó–∞–ø—É—Å—Ç–∏—Ç–µ: redis-server"
        echo "   (–∏–ª–∏ Redis –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ)"
    fi
else
    echo "‚ö†Ô∏è Redis –Ω–µ –Ω–∞–π–¥–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:"
    echo "   Ubuntu/Debian: sudo apt install redis-server"
    echo "   macOS: brew install redis"
    echo "   (–∏–ª–∏ Redis –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ)"
fi

# –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã
echo ""
echo "üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —É–ª—É—á—à–µ–Ω–∏–π..."
echo "============================================="
python3 test_improvements.py

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
echo ""
echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ bot.py..."
python3 -m py_compile bot.py

if [ $? -eq 0 ]; then
    echo "‚úÖ –°–∏–Ω—Ç–∞–∫—Å–∏—Å bot.py –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω"
else
    echo "‚ùå –û—à–∏–±–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ –≤ bot.py"
    exit 1
fi

echo ""
echo "üéâ –£–ª—É—á—à–µ–Ω–∏—è –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!"
echo "============================================="
echo ""
echo "üìù –ù–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã –≤ –±–æ—Ç–µ:"
echo "‚Ä¢ /test_date_parser - —Ç–µ—Å—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞—Ç"
echo "‚Ä¢ /test_limits - —Å—Ç–∞—Ç—É—Å –∑–∞—â–∏—Ç—ã –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏"
echo ""
echo "üõ°Ô∏è –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏:"
echo "‚Ä¢ –õ–∏–º–∏—Ç: 50 –∑–∞–ø—Ä–æ—Å–æ–≤/—á–∞—Å –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
echo "‚Ä¢ –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö LLM: 10 –∑–∞–ø—Ä–æ—Å–æ–≤"
echo "‚Ä¢ Retry: 5 –ø–æ–ø—ã—Ç–æ–∫ —Å exponential backoff"
echo ""
echo "üìÖ –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞—Ç:"
echo "‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ dateparser –¥–ª—è —Ä—É—Å—Å–∫–∏—Ö –¥–∞—Ç"
echo "‚Ä¢ Fallback –Ω–∞ —É–ª—É—á—à–µ–Ω–Ω—ã–π regex"
echo "‚Ä¢ –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Å–∫–ª–æ–Ω–µ–Ω–∏–π –∏ —Ñ–æ—Ä–º–∞—Ç–æ–≤"
echo ""
echo "üöÄ –î–ª—è –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞: python3 bot.py" 